<?php	header("Content-Type: application/json"); //Encabezado que indica el tipo de dato a devolver es JSON	include("../conexi.php");  //Se incluye el archivo de conexion a base de datos		$response= array(); //Asigna la respuesta a un arreglo vacio	$link=Conectarse(); //Crea la variable de conexion		$myusername=$_POST['id_usuarios']; //Asigna el usuario  enviado por el formulario	$mypassword=$_POST['password']; //Asigna la contraseña enviada por el formulario		$myusername = stripslashes($myusername); //Remueve caracteres de escape	$mypassword = stripslashes($mypassword); //Remueve caracteres de escape		$hash=sha1($mypassword);  //Genera el hash de la contraseña para comparar con la guardada			$sql="SELECT	id_usuarios,	nombre_usuarios,	permisos		FROM usuarios 	WHERE id_usuarios='$myusername' 	AND pass_usuarios='$hash'"; // Se definbe la consulta para buscar el usuario			$result=mysqli_query($link, $sql); //Ejecuta la consulta		if (!$result){		die('Error: ' . mysqli_error($link)); //Si hay error mandar aviso	}				// Si la consulta devuelve 1 fila inicia la sesion	if(mysqli_num_rows($result) ==1){			//Inicia la sesion		session_start();		session_regenerate_id(true);				$row = mysqli_fetch_assoc($result);						//Define las COOKIES con los datos de la sesion		setcookie("id_usuarios",  $row["id_usuarios"],  0, "/");		setcookie("permiso_usuarios", $row["permisos"],  0, "/");		setcookie("nombre_usuarios", $row["nombre_usuarios"],  0, "/");				//Devuelve los parametrso de la respuesta correcta		$response["login"] = "valid";		$response["permisos"] = $row["permisos"];			}	else{				//No se encontro usuario o contraseña invalida		$response["login"] = "invalid";		$response["query"] = $sql;		$response["mensaje"] = "Usuario y/o Contraseña Inválidos";	}	//Imprime la respuesta en formato JSON	echo json_encode($response);?>